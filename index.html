<!DOCTYPE html>
<html>
<head>
  <title>Hotel Booking</title>
  <style>
    body { font-family: Arial; }
    label { display:block; margin-top:10px; }
    button { margin-top:10px; }
    table { border-collapse: collapse; margin-top:20px; width:100%; }
    th, td { border:1px solid #000; padding:6px; text-align:center; }
    th { background:#eee; }
    #msg { color:red; font-weight:bold; }
  </style>
</head>
<body>

<h2>Hotel Booking</h2>

<label>Name:</label>
<input type="text" id="name">

<label>Check-in Date:</label>
<input type="date" id="checkin">

<label>Check-out Date:</label>
<input type="date" id="checkout">

<label>No of Rooms:</label>
<input type="number" id="rooms" min="1">

<label>Total Amount:</label>
<input type="text" id="amount" readonly>

<p id="msg"></p>

<button id="bookBtn">Book Now</button>

<hr>

<h3>Booking Details</h3>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Date</th>
      <th>Rooms</th>
      <th>Amount (₹)</th>
    </tr>
  </thead>
  <tbody id="details"></tbody>
</table>

<h3>Daily Summary</h3>
<table>
  <thead>
    <tr>
      <th>Date</th>
      <th>Total Rooms</th>
      <th>Total Amount (₹)</th>
    </tr>
  </thead>
  <tbody id="summary"></tbody>
</table>

<script>
const PRICE = 2000;
const MAX_ROOMS = 30;

const nameInput = document.getElementById("name");
const checkin = document.getElementById("checkin");
const checkout = document.getElementById("checkout");
const rooms = document.getElementById("rooms");
const amount = document.getElementById("amount");
const msg = document.getElementById("msg");
const details = document.getElementById("details");
const summary = document.getElementById("summary");
const bookBtn = document.getElementById("bookBtn");

let bookings = JSON.parse(localStorage.getItem("bookings")) || [];

render();

/* ---------- DATE VALIDATION ---------- */
checkin.addEventListener("change", () => {
  let today = new Date();
  today.setHours(0,0,0,0);
  if (new Date(checkin.value) < today) {
    alert("Past date not allowed");
    checkin.value = "";
  }
});

/* ---------- AUTO CALCULATOR ---------- */
rooms.addEventListener("input", calculate);
checkout.addEventListener("change", calculate);

function calculate() {
  if (!checkin.value || !checkout.value || !rooms.value) {
    amount.value = "";
    return;
  }

  let days =
    (new Date(checkout.value) - new Date(checkin.value)) /
    (1000 * 60 * 60 * 24);

  if (days <= 0) {
    alert("Check-out must be after check-in");
    checkout.value = "";
    amount.value = "";
    return;
  }

  amount.value = "₹ " + (days * rooms.value * PRICE);
}

/* ---------- BOOK NOW ---------- */
bookBtn.addEventListener("click", () => {
  if (!nameInput.value || !checkin.value || !rooms.value || !amount.value) {
    alert("Fill all details");
    return;
  }

  let todayRooms = bookings
    .filter(b => b.date === checkin.value)
    .reduce((s,b) => s + b.rooms, 0);

  if (todayRooms + Number(rooms.value) > MAX_ROOMS) {
    msg.innerText = "Rooms Filled for this date!";
    return;
  }

  bookings.push({
    name: nameInput.value,
    date: checkin.value,
    rooms: Number(rooms.value),
    amount: Number(amount.value.replace("₹",""))
  });

  localStorage.setItem("bookings", JSON.stringify(bookings));
  msg.innerText = "Booking Successful!";
  render();
});

/* ---------- DISPLAY TABLES ---------- */
function render() {
  details.innerHTML = "";
  summary.innerHTML = "";

  let daily = {};

  bookings.forEach(b => {
    details.innerHTML += `
      <tr>
        <td>${b.name}</td>
        <td>${b.date}</td>
        <td>${b.rooms}</td>
        <td>${b.amount}</td>
      </tr>`;

    if (!daily[b.date]) daily[b.date] = { rooms:0, amount:0 };
    daily[b.date].rooms += b.rooms;
    daily[b.date].amount += b.amount;
  });

  for (let d in daily) {
    summary.innerHTML += `
      <tr>
        <td>${d}</td>
        <td>${daily[d].rooms}</td>
        <td>${daily[d].amount}</td>
      </tr>`;
  }
}
</script>

</body>
</html>
